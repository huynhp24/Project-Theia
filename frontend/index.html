<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THEIA</title>

    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

    <!-- FONT GOOGLE -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <!-- HEADER -->
    <header>
        <div class="header__content">
            <p>THEIA</p>
            <nav>
                <ul>
                    <li class="active"><a href="#">HOME</a></li>
                    <li><a href="#">ABOUT</a></li>
                    <li><a href="#">SERVICE</a></li>
                    <li><a href="#">CONTACT</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <!-- CAROUSEL -->
    <section class="carousel">
        <div class="carousel__content">
            <h1>Object Detection Assistant</h1>
            <p>Automate your image analysis with machine learning.</p> <br> <br>
            <div class="carousel__options">
                <div>
                    <!-- <label for="imageUpload">Upload an image</label> <br> -->
                    <label for="imageUpload">Upload an image</label> <br>
                    <input id="imageUpload" type="file" name="img_path" accept=".png, .jpg"
                    max-size=15728640 hidden="hidden" onchange="submitPhoto(this)">
                    <button id="custom-button">Choose File</button>   
                    <span id="custom-text">No file chosen</span> 
                    <!-- <button onclick="return upload()">Upload image</button>   -->
                </div>
                <br> <br> <br> <br> 
                <div>
                    <label for="pasteURL">Paste image URL</label> <br>
                    <input id="pasteURL" type="text" name="img_url" placeholder="URL.."> <br>
                    <!-- <input type="submit" name="btn_submit" value="Search by image"> -->
                    <button onclick="return submitURL()">Search by image</button>
                </div>
            </div>

        </div>
    </section>

    <script>
        const imageUploadBtn = document.getElementById("imageUpload");
        const customBtn = document.getElementById("custom-button");
        const customTxt = document.getElementById("custom-text");

        customBtn.addEventListener("click", function(){
            imageUploadBtn.click();
        });

        imageUploadBtn.addEventListener("change", function(){
            if (imageUploadBtn.value) {
                customTxt.innerHTML = imageUploadBtn.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
            } else {
                customTxt.innerHTML = "No file chosen";
            }
        });
    </script>

    <script>
        function submitPhoto(e) {
            let xhr = new XMLHttpRequest();
            let formData = new FormData();
            let photo = e.files[0];      
            
            formData.append("file", photo);
            
            xhr.onreadystatechange = state => { console.log(xhr.status); } // err handling
            xhr.open("POST", "http://localhost:5000/theia/api/v1.0/img_path", true);    
            // xhr.setRequestHeader("Content-Type","multipart/form-data");
            xhr.send(formData);
        }
    </script>

    <script>
        function submitURL() {
            const img_url = document.querySelector('#pasteURL').value;

            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'http://localhost:5000/theia/api/v1.0/img_url', true);
            xhr.setRequestHeader('Content-Type', 'plain/text');
            xhr.send(img_url);
        }
    </script>
</body>
</html>